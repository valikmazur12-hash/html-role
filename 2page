2page

{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>–¢–∞–±–ª–∏—Ü—ñ</title>
    <meta charset="UTF-8"> 
    <link rel="stylesheet" href="{% static 'main/data_view.css' %}?v=1.1">
</head>
<body>
    <div class="container">
        
        <header class="header">
            <div class="header-content">
                <h1>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –†–æ–ª–µ–π –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º</h1>
                <nav class="main-nav">
                    <ul>
                        <li><a href="{% url 'role_assignment' %}">–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</a></li>
                        <li><a href="{% url 'page_two' %}">–¢–∞–±–ª–∏—Ü—ñ</a></li>
                        <li><a href="{% url 'page_three' %}">–°—Ö–µ–º–∞</a></li>
                        <li><a href="{% url 'page_four' %}" class="active">–ü—Ä–æ—Ñ—ñ–ª—å</a></li> 
                    </ul>
                </nav>
            </div>
        </header>

        <div class="main-form">
            <h2>üìú –¢–∞–±–ª–∏—Ü—è –∑–∞–ø–∏—Å—ñ–≤ (User_list)</h2>

            <div class="filters-container">
                
                <div class="filter-group filter-checkboxes">
                    <label>–§—ñ–ª—å—Ç—Ä –ø–æ –î–æ–¥–∞—Ç–∫—É (–ß–µ–∫–±–æ–∫—Å–∏):</label>
                    <div id="app-filter-checkboxes">
                        <div class="checkbox-item"><input type="checkbox" name="app_filter" value="ERP"><label>ERP_Finance</label></div>
                        <div class="checkbox-item"><input type="checkbox" name="app_filter" value="CRM"><label>CRM_Sales</label></div>
                        <div class="checkbox-item"><input type="checkbox" name="app_filter" value="HR"><label>HR_Portal</label></div>
                        </div>
                </div>
                
                <div class="filter-group filter-text">
                    <label for="role-filter">–§—ñ–ª—å—Ç—Ä –ø–æ –†–æ–ª—ñ:</label>
                    <input type="text" id="role-filter" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ä–æ–ª—ñ">
                </div>

                <button class="filter-button" onclick="applyFilters()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
            </div>
            
            <div class="data-table-container">
                <table class="roles-table">
                    <thead>
                        <tr>
                            <th style="width: 5%;">ID</th>
                            <th style="width: 20%;">–ü–Ü–ë –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</th>
                            <th style="width: 15%;">–ü–æ—Å–∞–¥–∞</th>
                            <th style="width: 30%;">–î–æ–¥–∞—Ç–æ–∫</th>
                            <th style="width: 30%;">–†–æ–ª—ñ</th>
                        </tr>
                    </thead>
                    <tbody id="full-report-tbody">
                        
                        {% for user_data in report_data %}
                        <tr>
                            <td>{{ user_data.id_user }}</td>
                            <td>{{ user_data.pib }}</td>
                            <td>{{ user_data.position }}</td>
                            <td>
                                {% for role in user_data.roles_data %}
                                    {{ role.application }}{% if not forloop.last %}<br>{% endif %}
                                {% endfor %}
                            </td>
                            <td>
                                {% for role in user_data.roles_data %}
                                    {{ role.role_name }}{% if not forloop.last %}<br>{% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" style="text-align: center;">–î–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</td>
                        </tr>
                        {% endfor %}
                        
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        function applyFilters() {
            // 1. –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ —á–µ–∫–±–æ–∫—Å—ñ–≤
            const selectedApps = Array.from(document.querySelectorAll('#app-filter-checkboxes input:checked'))
                                     .map(checkbox => checkbox.value);
            
            // 2. –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ—ñ–ª—å—Ç—Ä–∞
            const roleFilterText = document.getElementById('role-filter').value.trim();

            // 3. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –≤–∏–±—Ä–∞–Ω–æ —â–æ—Å—å
            if (selectedApps.length === 0 && roleFilterText === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –¥–æ–¥–∞—Ç–æ–∫ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ä–æ–ª—ñ –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó.');
                return;
            }
            
            // 4. –¢–∏–º—á–∞—Å–æ–≤–∏–π –≤–∏–≤—ñ–¥:
            console.log("–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ –î–æ–¥–∞—Ç–∫–∞–º–∏:", selectedApps);
            console.log("–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ –†–æ–ª–ª—é:", roleFilterText);

            // 5. ‚ö†Ô∏è –£ —Ä–µ–∞–ª—å–Ω–æ–º—É Django-–ø—Ä–æ—î–∫—Ç—ñ —Ç—É—Ç –º–∞—î –±—É—Ç–∏ AJAX-–∑–∞–ø–∏—Ç:
            // fetch('/reports/?apps=' + selectedApps.join(',') + '&role=' + roleFilterText)
            //     .then(response => response.json())
            //     .then(data => updateTable(data));
            
            alert(`–ó–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ —Ñ—ñ–ª—å—Ç—Ä–∏: –î–æ–¥–∞—Ç–∫–∏ (${selectedApps.join(', ')}) —Ç–∞ –†–æ–ª—å (${roleFilterText}).\n–¶—è –ª–æ–≥—ñ–∫–∞ –≤–∏–º–∞–≥–∞—î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ (Views.py)`);
        }
    </script>
</body>
</html>
