{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ Ğ¾Ğ»ĞµĞ¹</title>
    <meta charset="UTF-8"> 
    <link rel="stylesheet" href="{% static 'main/data_view.css' %}?v=1.1">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ Ğ¾Ğ»ĞµĞ¹ ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°Ğ¼</h1>
                <nav class="main-nav">
                    <ul>
                        <li><a href="{% url 'role_assignment' %}">ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ</a></li>
                        <li><a href="{% url 'page_two' %}">Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ–</a></li>
                        <li><a href="{% url 'page_three' %}">Ğ¡Ñ…ĞµĞ¼Ğ°</a></li>
                        <li><a href="{% url 'page_four' %}" class="active">ĞŸÑ€Ğ¾Ñ„Ñ–Ğ»ÑŒ</a></li> 
                    </ul>
                </nav>
            </div>
        </header>

        <div class="main-form">
            <h2>Ğ”Ğ°Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°:</h2>
            
            <label class="group-label">ĞŸĞ†Ğ‘ (ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ, Ğ†Ğ¼'Ñ, ĞŸĞ¾ Ğ±Ğ°Ñ‚ÑŒĞºĞ¾Ğ²Ñ–):</label>
            
            <div class="input-row-container">
                
                <div class="fio-inputs">
                    <input type="text" id="prizvische" placeholder="ĞŸÑ€Ñ–Ğ·Ğ²Ğ¸Ñ‰Ğµ" oninput="handleInput(event)">
                    <input type="text" id="name" placeholder="Ğ†Ğ¼'Ñ" oninput="handleInput(event)">
                    <input type="text" id="father_name" placeholder="ĞŸĞ¾ Ğ±Ğ°Ñ‚ÑŒĞºĞ¾Ğ²Ñ–" oninput="handleInput(event)">
                </div>

                <div class="position-group">
                    <input type="text" id="position" placeholder="ĞŸĞ¾ÑĞ°Ğ´Ğ°" readonly>
                </div>
                
                <button class="add-button" onclick="addRole()">
                    â• Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ Ğ¾Ğ»ÑŒ
                </button>
            </div>
            
            <ul id="suggestions" class="autocomplete-dropdown"></ul>
        </div>
        
        <div id="role-management-block" class="management-block" style="display: none;"> 
            <h3>ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ– Ğ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ</h3>
            <table class="roles-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº</th>
                        <th style="width: 40%;">Ğ Ğ¾Ğ»ÑŒ</th>
                        <th style="width: 20%;">Ğ”Ñ–Ñ</th>
                    </tr>
                </thead>
                <tbody id="user-roles-tbody">
                    </tbody>
            </table>
        </div>
        
        <div id="role-selection-block" class="selection-form-block" style="display: none;">
            <h3>ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ… Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ñƒ</h3>
            <p>ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡: <strong id="selected-user-info"></strong></p>
            
            <div class="selection-controls-container">
                
                <div class="selection-control-group">
                    <label for="app-select">Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº:</label>
                    <select id="app-select" onchange="handleAppChange()">
                        <option value="">Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº</option>
                    </select>
                </div>
                
                <div class="selection-control-group">
                    <label for="group-select">Ğ“Ñ€ÑƒĞ¿Ğ°:</label>
                    <select id="group-select" onchange="handleGroupChange()" disabled>
                        <option value="">Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ñƒ</option>
                    </select>
                </div>
                
                <div class="selection-control-group">
                    <label for="role-type-select">Ğ¢Ğ¸Ğ¿ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ:</label>
                    <select id="role-type-select" disabled>
                        <option value="multiple">Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¾Ğ²Ñ– Ñ€Ğ¾Ğ»Ñ–</option>
                        <option value="single">ĞĞ´Ğ¸Ğ½Ğ°Ñ€Ğ½Ğ° Ñ€Ğ¾Ğ»ÑŒ (Ğ·Ğ°Ğ¼Ñ–Ğ½ÑÑ” Ñ–Ğ½ÑˆÑ–)</option>
                    </select>
                </div>
            </div>
            
            <div class="role-list-container">
                <h4>Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ– Ñ€Ğ¾Ğ»Ñ–:</h4>
                <div id="available-roles-list" class="available-roles-list">
                    </div>
            </div>
            
            <div class="action-buttons-group">
                <button class="approve-button" onclick="approveNewRole()">
                    âœ… ĞĞ´Ğ¾Ğ±Ñ€Ğ¸Ñ‚Ğ¸
                </button>
                <button class="cancel-button" onclick="cancelRoleSelection()">
                    âœ–ï¸ Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸
                </button>
            </div>
        </div>
    </div>
Â  Â  
    <script>
        // ==========================================================
        // 1. Ğ¡Ğ¢ĞĞ¢Ğ˜Ğ§ĞĞ† Ğ”ĞĞĞ† (MOCK DATA)
        // ==========================================================
        const DATA_SOURCE = JSON.parse('{{ user_data_json | safe }}'); 
        
        const APP_DATA = [
            { id_app: 101, app_name: 'ERP_Finance', app_disc: 'Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ„Ñ–Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ»Ñ–ĞºÑƒ' },
            { id_app: 102, app_name: 'CRM_Sales', app_disc: 'ĞœĞ¾Ğ´ÑƒĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ°Ğ¼Ğ¸' },
            { id_app: 103, app_name: 'HR_Portal', app_disc: 'Ğ’Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ–Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ğ¾Ğ¼' },
        ];
        
        const GROUP_DATA = [
            { id_group: 10, Name: 'Admin_Fin', id_app: 101, opption: 1, disc: 'ĞĞ´Ğ¼Ñ–Ğ½Ñ–ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¸ Ğ¤Ñ–Ğ½Ğ°Ğ½ÑÑ–Ğ²' },
            { id_group: 20, Name: 'Sales_Users', id_app: 102, opption: 1, disc: 'ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ñ– ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ñ–Ğ²' },
            { id_group: 30, Name: 'HR_Staff', id_app: 103, opption: 1, disc: 'ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ» HR' },
            { id_group: 110, Name: 'Global_Managers', id_app: 101, opption: 0, disc: 'Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ– ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¸' },
        ];
        
        const ROLE_DATA = [
            { id_role: 1001, Name: 'Fin_Full_Access', Discription: 'ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ´Ğ¾ Ñ„Ñ–Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ğ¹', id_group: 10 },
            { id_role: 1002, Name: 'Fin_View_Only', Discription: 'Ğ¢Ñ–Ğ»ÑŒĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ³Ğ»ÑĞ´ Ñ„Ñ–Ğ½Ğ°Ğ½ÑĞ¾Ğ²Ğ¸Ñ… Ğ·Ğ²Ñ–Ñ‚Ñ–Ğ²', id_group: 10 },
            { id_role: 2001, Name: 'Sales_Editor', Discription: 'Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ ÑƒĞ³Ğ¾Ğ´ Ñ‚Ğ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ² Ğ² CRM', id_group: 20 },
            { id_role: 3001, Name: 'HR_Reader', Discription: 'ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»Ñƒ', id_group: 30 },
            { id_role: 1101, Name: 'Global_Read', Discription: 'ĞŸĞµÑ€ĞµĞ³Ğ»ÑĞ´ ÑƒÑÑ–Ñ… Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¸Ñ… Ğ·Ğ²Ñ–Ñ‚Ñ–Ğ²', id_group: 110 },
        ];


        // ==========================================================
        // 2. ĞŸĞĞ¡Ğ˜Ğ›ĞĞĞĞ¯ ĞĞ Ğ•Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ˜ Ğ¢Ğ Ğ“Ğ›ĞĞ‘ĞĞ›Ğ¬ĞĞ˜Ğ™ Ğ¡Ğ¢ĞĞ
        // ==========================================================
Â  Â  Â  Â  const suggestionsContainer = document.getElementById('suggestions');
Â  Â  Â  Â  const prizvischeInput = document.getElementById('prizvische');
Â  Â  Â  Â  const nameInput = document.getElementById('name');
Â  Â  Â  Â  const fatherNameInput = document.getElementById('father_name');
Â  Â  Â  Â  const positionInput = document.getElementById('position');
        const roleManagementBlock = document.getElementById('role-management-block');
        const rolesTbody = document.getElementById('user-roles-tbody');
        
        const roleSelectionBlock = document.getElementById('role-selection-block');
        const appSelect = document.getElementById('app-select');
        const groupSelect = document.getElementById('group-select');
        const roleTypeSelect = document.getElementById('role-type-select');
        const availableRolesList = document.getElementById('available-roles-list');
        const selectedUserInfo = document.getElementById('selected-user-info');

        let currentUserId = null; // Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ” ID Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
        let currentUserName = ''; // Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ” ĞŸĞ†Ğ‘ Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°

        // ==========================================================
        // 3. Ğ¤Ğ£ĞĞšĞ¦Ğ†Ğ‡ Ğ”Ğ›Ğ¯ Ğ£ĞŸĞ ĞĞ’Ğ›Ğ†ĞĞĞ¯ Ğ ĞĞ›Ğ¯ĞœĞ˜ (Ğ†ÑĞ½ÑƒÑÑ‡Ñ–)
        // ==========================================================

        function loadUserRoles(userId) {
            rolesTbody.innerHTML = ''; 
            roleSelectionBlock.style.display = 'none'; // ĞŸÑ€Ğ¸Ñ…Ğ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ñ– ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°
            
            const dummyRoles = [
                { id: 101, app: 'ERP - Ğ¤Ñ–Ğ½Ğ°Ğ½ÑĞ¸', role: 'Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ñ€Ğ°Ñ…ÑƒĞ½ĞºÑ–Ğ²' },
                { id: 102, app: 'HR-ĞŸĞ¾Ñ€Ñ‚Ğ°Ğ»', role: 'Ğ§Ğ¸Ñ‚Ğ°Ñ‡' }
            ];
            
            dummyRoles.forEach(role => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${role.app}</td>
                    <td>${role.role}</td>
                    <td><button class="delete-role-btn" onclick="deleteRole(${role.id}, '${role.role}')">Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸</button></td>
                `;
                rolesTbody.appendChild(row);
            });
        }
        
        function deleteRole(roleId, roleName) {
            alert(`Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ñ€Ğ¾Ğ»Ñ– "${roleName}" (ID: ${roleId}). Ğ¢ÑƒÑ‚ Ğ±ÑƒĞ´Ğµ AJAX-Ğ·Ğ°Ğ¿Ğ¸Ñ‚.`);
        }
        
        // ==========================================================
        // 4. Ğ›ĞĞ“Ğ†ĞšĞ ĞĞ’Ğ¢ĞĞ—ĞĞŸĞĞ’ĞĞ•ĞĞĞ¯ 
        // ==========================================================

Â  Â  Â  Â  function handleInput(event) {
Â  Â  Â  Â  Â  Â  const prizvischeVal = prizvischeInput.value.toLowerCase();
Â  Â  Â  Â  Â  Â  const nameVal = nameInput.value.toLowerCase();
Â  Â  Â  Â  Â  Â  const fatherNameVal = fatherNameInput.value.toLowerCase();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!prizvischeVal && !nameVal && !fatherNameVal) {
Â  Â  Â  Â  Â  Â  Â  Â  suggestionsContainer.innerHTML = '';
                roleManagementBlock.style.display = 'none';
                roleSelectionBlock.style.display = 'none';
                currentUserId = null; // Ğ¡ĞºĞ¸Ğ´Ğ°Ñ”Ğ¼Ğ¾ ID
                positionInput.value = ''; // ĞÑ‡Ğ¸Ñ‰Ğ°Ñ”Ğ¼Ğ¾ Ğ¿Ğ¾ÑĞ°Ğ´Ñƒ
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  
Â  Â  Â  Â  Â  Â  const filteredUsers = DATA_SOURCE.filter(user => {
Â  Â  Â  Â  Â  Â  Â  Â  const matchesPrizvische = user.Prizvische.toLowerCase().includes(prizvischeVal);
Â  Â  Â  Â  Â  Â  Â  Â  const matchesName = user.Name.toLowerCase().includes(nameVal);
Â  Â  Â  Â  Â  Â  Â  Â  const matchesFatherName = user.Father_Name.toLowerCase().includes(fatherNameVal);
Â  Â  Â  Â  Â  Â  Â  Â  return matchesPrizvische && matchesName && matchesFatherName;
Â  Â  Â  Â  Â  Â  });
Â  Â  
Â  Â  Â  Â  Â  Â  suggestionsContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  filteredUsers.slice(0, 10).forEach(user => { 
Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  item.textContent = `${user.Prizvische} ${user.Name} ${user.Father_Name} (${user.Position})`;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  item.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ğŸš€ Ğ¢ÑƒÑ‚ Ğ²Ñ–Ğ´Ğ±ÑƒĞ²Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ğ½Ğ½Ñ–!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  prizvischeInput.value = user.Prizvische;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nameInput.value = user.Name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fatherNameInput.value = user.Father_Name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  positionInput.value = user.Position;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
                    currentUserId = user.id_user; 
                    currentUserName = `${user.Prizvische} ${user.Name} ${user.Father_Name}`; 
                    
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  suggestionsContainer.innerHTML = ''; 
                    
                    roleManagementBlock.style.display = 'block'; 
                    loadUserRoles(currentUserId); // Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ”Ğ¼Ğ¾ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ– Ñ€Ğ¾Ğ»Ñ–
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  suggestionsContainer.appendChild(item);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  
        // ==========================================================
        // 5. Ğ›ĞĞ“Ğ†ĞšĞ ĞšĞĞĞŸĞšĞ˜ "Ğ”ĞĞ”ĞĞ¢Ğ˜ Ğ ĞĞ›Ğ¬" (ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°)
        // ==========================================================

Â  Â  Â  Â  function addRole() {
Â  Â  Â  Â  Â  Â  if (!currentUserId) {
Â  Â  Â  Â  Â  Â  Â  Â  // ğŸš€ Ğ’Ğ˜ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞĞ¯: ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾ Ğ½ĞµĞ¾Ğ±Ñ…Ñ–Ğ´Ğ½Ñ–ÑÑ‚ÑŒ Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ğ½Ğ½Ñ
Â  Â  Â  Â  Â  Â  Â  Â  alert('Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, **Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ°** Ğ·Ñ– ÑĞ¿Ğ¸ÑĞºÑƒ Ğ¿Ñ–Ğ´ĞºĞ°Ğ·Ğ¾Ğº, Ğ½Ğ°Ñ‚Ğ¸ÑĞ½ÑƒĞ²ÑˆĞ¸ Ğ½Ğ° Ğ½ÑŒĞ¾Ğ³Ğ¾. Ğ¢Ñ–Ğ»ÑŒĞºĞ¸ Ğ¿Ñ–ÑĞ»Ñ Ñ†ÑŒĞ¾Ğ³Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ñ€Ğ¾Ğ»ÑŒ.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
            
            // Ğ¯ĞºÑ‰Ğ¾ ID Ñ”, Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ”Ğ¼Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ñ– Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ”Ğ¼Ğ¾ Ğ´Ğ°Ğ½Ñ–
            selectedUserInfo.textContent = currentUserName;
            roleSelectionBlock.style.display = 'block';
            
            renderAppSelection();
Â  Â  Â  Â  }
        
        // ==========================================================
        // 6. Ğ›ĞĞ“Ğ†ĞšĞ Ğ¤ĞĞ ĞœĞ˜ Ğ’Ğ˜Ğ‘ĞĞ Ğ£ Ğ ĞĞ›Ğ•Ğ™ (Ğ‘ĞµĞ· Ğ·Ğ¼Ñ–Ğ½)
        // ==========================================================
        
        function renderAppSelection() {
            // ĞÑ‡Ğ¸Ñ‰ĞµĞ½Ğ½Ñ Ñ‚Ğ° Ğ·Ğ°Ğ¿Ğ¾Ğ²Ğ½ĞµĞ½Ğ½Ñ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€Ğ° Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºÑ–Ğ²
            appSelect.innerHTML = '<option value="">Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ´Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº</option>';
            // ... (Ğ²Ğ°ÑˆĞ° Ñ–ÑĞ½ÑƒÑÑ‡Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° renderAppSelection) ...
            const uniqueAppIds = [...new Set(GROUP_DATA.map(g => g.id_app))];
            
            uniqueAppIds.forEach(id => {
                const app = APP_DATA.find(a => a.id_app === id);
                if (app) {
                    const option = document.createElement('option');
                    option.value = app.id_app;
                    option.textContent = `${app.app_name} (${app.app_disc})`;
                    appSelect.appendChild(option);
                }
            });

            groupSelect.innerHTML = '<option value="">Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ñƒ</option>';
            groupSelect.disabled = true;
            availableRolesList.innerHTML = '';
        }

        function handleAppChange() {
            // ... (Ğ²Ğ°ÑˆĞ° Ñ–ÑĞ½ÑƒÑÑ‡Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° handleAppChange) ...
            const selectedAppId = parseInt(appSelect.value);
            groupSelect.innerHTML = '<option value="">Ğ’Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ñƒ</option>';
            groupSelect.disabled = true;
            availableRolesList.innerHTML = '';

            if (selectedAppId) {
                const groupsForApp = GROUP_DATA.filter(group => group.id_app === selectedAppId);
                
                groupsForApp.forEach(group => {
                    const option = document.createElement('option');
                    option.value = group.id_group;
                    option.textContent = `${group.Name} (${group.disc})`;
                    groupSelect.appendChild(option);
                });
                groupSelect.disabled = false;
            }
        }
        
        function handleGroupChange() {
            // ... (Ğ²Ğ°ÑˆĞ° Ñ–ÑĞ½ÑƒÑÑ‡Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° handleGroupChange) ...
            const selectedGroupId = parseInt(groupSelect.value);
            availableRolesList.innerHTML = '';
            
            if (selectedGroupId) {
                const rolesForGroup = ROLE_DATA.filter(role => role.id_group === selectedGroupId);
                const groupInfo = GROUP_DATA.find(g => g.id_group === selectedGroupId);
                
                roleTypeSelect.value = groupInfo.opption === 1 ? 'single' : 'multiple';
                
                rolesForGroup.forEach(role => {
                    const roleItem = document.createElement('div');
                    roleItem.className = 'role-checkbox-item';
                    roleItem.innerHTML = `
                        <input type="checkbox" id="role-${role.id_role}" name="role" value="${role.id_role}">
                        <label for="role-${role.id_role}">
                            <strong>${role.Name}</strong>: ${role.Discription}
                        </label>
                    `;
                    availableRolesList.appendChild(roleItem);
                });
            }
        }

        function approveNewRole() {
            // ... (Ğ²Ğ°ÑˆĞ° Ñ–ÑĞ½ÑƒÑÑ‡Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° approveNewRole) ...
            const selectedRoles = Array.from(availableRolesList.querySelectorAll('input:checked')).map(input => input.value);
            const selectedApp = appSelect.options[appSelect.selectedIndex].text;
            const selectedGroup = groupSelect.options[groupSelect.selectedIndex].text;
            
            if (selectedRoles.length === 0) {
                alert('Ğ‘ÑƒĞ´ÑŒ Ğ»Ğ°ÑĞºĞ°, Ğ²Ğ¸Ğ±ĞµÑ€Ñ–Ñ‚ÑŒ Ñ…Ğ¾Ñ‡Ğ° Ğ± Ğ¾Ğ´Ğ½Ñƒ Ñ€Ğ¾Ğ»ÑŒ.');
                return;
            }
            
            const roleNames = selectedRoles.map(id => ROLE_DATA.find(r => r.id_role === parseInt(id)).Name).join(', ');
            
            alert(`
                âœ… Ğ—Ğ°Ğ¿Ğ¸Ñ‚ Ğ½Ğ° Ñ€Ğ¾Ğ»ÑŒ ÑÑ…Ğ²Ğ°Ğ»ĞµĞ½Ğ¾!
                ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡: ${currentUserName} (ID: ${currentUserId})
                Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¾Ğº: ${selectedApp}
                Ğ“Ñ€ÑƒĞ¿Ğ°: ${selectedGroup}
                Ğ Ğ¾Ğ»Ñ–: ${roleNames}
                (Ğ¢ÑƒÑ‚ Ğ±ÑƒĞ´Ğµ AJAX-Ğ·Ğ°Ğ¿Ğ¸Ñ‚ Ğ´Ğ¾ Django Ğ´Ğ»Ñ Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ)
            `);
            
            cancelRoleSelection(); 
        }

        function cancelRoleSelection() {
            // ... (Ğ²Ğ°ÑˆĞ° Ñ–ÑĞ½ÑƒÑÑ‡Ğ° Ğ»Ğ¾Ğ³Ñ–ĞºĞ° cancelRoleSelection) ...
            roleSelectionBlock.style.display = 'none';
            appSelect.value = '';
            groupSelect.value = '';
            groupSelect.disabled = true;
            roleTypeSelect.value = 'multiple';
            availableRolesList.innerHTML = '';
        }

Â  Â  </script>
Â  Â  
</body>
</html>
